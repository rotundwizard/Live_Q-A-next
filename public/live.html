<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Live Question</title>
  <style>
    html, body {
      height: 100%; /* Ensure both html and body take up the full height */
      margin: 0; /* Remove default margin */
      display: flex; /* Enable flexbox */
      justify-content: center; /* Center horizontally */
      align-items: center; /* Center vertically */
      font-family: sans-serif;
      text-align: center;
      background: #000000;
    }
    #live-question-container {
      display: flex;
      flex-direction: column; /* Stack children vertically */
      align-items: center; /* Center children horizontally */
    }
    #live-question {
      font-size: 2em;
      color: white;
      padding: 20px;
    }
    #username {
      font-style: italic;
      color: #e7ff2e;
      margin-top: 10px;
    }
    #event-name {
      font-size: 1.5em;
      color: #ffffff;
      margin-top: 20px;
    }
    #event-url {
      font-size: 1.2em;
      color: #ffffff;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div id="live-question-container">
    <div id="qr-code-container" style="margin-bottom: 20px;"></div>
    <div id="live-question">Waiting for a live question...</div>
    <div id="username"></div>
    <div id="event-name">VBC Live Event</div>
    <div id="event-url">Event URL: Not Set</div>
  </div>
  <script src="/socket.io/socket.io.js"></script>
  <script src="/AdditionalLibraries/qrcode.js"></script>
  <script>
    // Test for Connection
    const socket = io('http://localhost:3000'); // Replace 3000 with your server's port
    socket.on('connect', () => {
      console.log('Connected to server:', socket.id);
    });
    // END TEST
    const display = document.getElementById('live-question');
    const user = document.getElementById('username');
    const eventName = document.getElementById('event-name');
    const eventUrl = document.getElementById('event-url');
    const qrCodeContainer = document.getElementById('qr-code-container');

    let currentEventName = 'VBC Live Event'; // Default event name
    let currentEventURL = 'Event URL: Not Set'; // Default event URL

    socket.on('live_question', (question) => {
      const eventNameContainer = document.getElementById('event-name');
      const eventUrlContainer = document.getElementById('event-url');

      if (question) {
        // Display the live question and username
        user.textContent = question.username ? `- ${question.username}` : '- Anonymous';
        display.textContent = question.text;

        // Hide Event Name and Event URL
        eventNameContainer.style.display = 'none';
        eventUrlContainer.style.display = 'none';
        qrCodeContainer.style.display = 'none';
      } else {
        // Clear the live question display and show the participant view URL
        user.textContent = '';
        display.textContent = 'Waiting for a live question...';

        // Show Event Name and Event URL
        eventNameContainer.style.display = 'block';
        eventUrlContainer.style.display = 'block';
        qrCodeContainer.style.display = 'block';

        // Restore the stored values for Event Name and Event URL
        eventName.textContent = currentEventName;
        eventUrl.textContent = currentEventURL;
      }
    });

    function generateQRCode(url) {
      // Clear any existing QR code
      qrCodeContainer.innerHTML = '';

      // Generate a new QR code
      new QRCode(qrCodeContainer, {
        text: url,
        width: 128, // Width of the QR code
        height: 128, // Height of the QR code
        colorDark: "#000000", // Dark color
        colorLight: "#ffffff", // Light color
        correctLevel: QRCode.CorrectLevel.H // Error correction level
      });
    }
    
    // Listen for event name updates
    socket.on('event_name_updated', ({ eventName: updatedEventName }) => {
      currentEventName = updatedEventName; // Update the stored value
      eventName.textContent = `${updatedEventName}`;
    });

    // Listen for event URL updates
    socket.on('event_ip_updated', ({ eventURL }) => {
      currentEventURL = `To submit questions, please visit ${eventURL}`; // Update the stored value
      eventUrl.textContent = currentEventURL;
      generateQRCode(eventURL); // Generate QR code for the event URL
    });

  </script>
</body>
</html>
