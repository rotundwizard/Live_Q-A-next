<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Live Q&A</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 600px; margin: auto; padding: 20px; }
    #questions div { margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
    .hidden { display: none; }
  </style>

</head>
<body>
  <h1>Live Q&A</h1>

  <div id="participant">
    <input id="username" placeholder="Enter your name (optional)">
    <textarea id="question" placeholder="Your question..."></textarea><br>
    <button onclick="submitQuestion()">Submit</button>
    <h2>Approved Questions</h2>
    <div id="questions"></div>
  </div>

  <hr>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    const votedQuestions = new Set(); // Track questions the participant has voted on
    let username = ''; // Store the participant's username

    // Submit a question
    function submitQuestion() {
      username = document.getElementById('username').value;
      const text = document.getElementById('question').value;
      if (text.trim()) {
        socket.emit('submit_question', { username, text });
        document.getElementById('question').value = '';
      }
    }

    // Listen for approved questions from the server
    socket.on('approved_questions', (questions) => {
      updateQuestionList(questions);
    });

    // Update the list of approved questions
    function updateQuestionList(questions) {
      const container = document.getElementById('questions');
      container.innerHTML = '';

      questions.forEach((q) => {
        const div = document.createElement('div');
        div.className = 'question';
        div.innerHTML = `
          <span>${q.text} | ${q.upvotes}</span>
          ${q.username !== username && !votedQuestions.has(q.id) ? 
            `<button onclick="vote('${q.id}')">Vote</button>` : ''}
        `;
        container.appendChild(div);
      });
    }

    // Vote for a question
    function vote(id) {
      if (!votedQuestions.has(id)) {
        socket.emit('upvote', id);
        votedQuestions.add(id); // Mark the question as voted
        updateQuestionList([...document.querySelectorAll('.question')].map(div => ({
          id: div.querySelector('button')?.getAttribute('onclick')?.match(/'([^']+)'/)?.[1],
          text: div.querySelector('span').textContent.split(' (')[0],
          upvotes: parseInt(div.querySelector('span').textContent.match(/\((\d+) votes\)/)?.[1] || 0) + 1,
          username: username
        })));
      }
    }

    // Approve a question
//    function approveQuestion(id) {
//      db.run("UPDATE questions SET status = 'approved' WHERE id = ?", [id]);
//    }
  </script>
</body>
</html>
